<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AI æœ¨ç´æ©Ÿ 2.0 - å¤šè»Œä¸¦è¡Œ</title>
    <style>
        body { margin: 0; background: #001; color: #fff; font-family: sans-serif; overflow: hidden; }
        .ui { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 100; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 10px; border: 1px solid #3b82f6; }
        button { padding: 8px 15px; border-radius: 5px; border: none; background: #3b82f6; color: white; font-weight: bold; cursor: pointer; }
        canvas { display: block; }
    </style>
</head>
<body>

<div class="ui">
    <input type="file" id="midiInput" accept=".mid,.midi" style="display:none">
    <button onclick="document.getElementById('midiInput').click()">ğŸ“ ä¸Šå‚³ MIDI æª”æ¡ˆ</button>
    <button onclick="startMultiTrack()">ğŸš€ å•Ÿå‹•å¤šè»Œæ¼”å¥</button>
</div>

<canvas id="stage"></canvas>

<script>
const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let balls = []; // å­˜å„²å¤šé¡†çƒ
let lanes = []; // å­˜å„²å¤šå€‹è»Œé“çš„éŸ³æ¿

function startMultiTrack() {
    balls = []; lanes = [];
    const trackCount = 2; // å…ˆä»¥é›™è»Œæ¸¬è©¦ (ä¾‹å¦‚é‹¼ç´å·¦å³æ‰‹)
    
    for(let i = 0; i < trackCount; i++) {
        const laneY = (canvas.height / (trackCount + 1)) * (i + 1);
        const color = i === 0 ? "#f87171" : "#60a5fa"; // ç´…çƒè·‘é«˜éŸ³ï¼Œè—çƒè·‘ä½éŸ³
        
        // æ¨¡æ“¬éŸ³æ¿ä½ˆå±€ (æœªä¾†ç”± MIDI è§£ææä¾›)
        let trackSteps = [];
        for(let j = 0; j < 15; j++) {
            trackSteps.push({
                x: 400 + j * 180,
                y: laneY + Math.sin(j) * 30, // ç¨å¾®èµ·ä¼å¢åŠ ç¾æ„Ÿ
                w: 80, h: 15, color: color
            });
        }
        lanes.push(trackSteps);
        
        // åˆå§‹åŒ–è©²è»Œé“çš„çƒ
        balls.push({
            x: 100, y: laneY - 100,
            vx: 3.5, vy: 0, r: 10, color: color,
            currentIdx: 0, laneY: laneY
        });
    }
    requestAnimationFrame(loop);
}

function loop() {
    ctx.fillStyle = "rgba(2, 6, 23, 0.3)"; // å¢åŠ æ®˜å½±æ•ˆæœ
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    const camX = balls.length > 0 ? balls[0].x - 200 : 0; // ä»¥ä¸»æ—‹å¾‹çƒç‚ºæ”å½±æ©Ÿä¸­å¿ƒ

    ctx.save();
    ctx.translate(-camX, 0);

    lanes.forEach((steps, laneIdx) => {
        steps.forEach(s => {
            ctx.fillStyle = s.color;
            ctx.beginPath(); ctx.roundRect(s.x, s.y, s.w, s.h, 5); ctx.fill();
        });

        let b = balls[laneIdx];
        if (b) {
            // ç°¡æ˜“ç‰©ç†é‚è¼¯
            b.vy += 0.25; b.x += b.vx; b.y += b.vy;
            
            let target = steps[b.currentIdx];
            if (target && b.x + b.r > target.x && b.x - b.r < target.x + target.w &&
                b.y + b.r > target.y && b.vy > 0) {
                b.y = target.y - b.r; b.vy = -7; // å½ˆè·³
                b.currentIdx++;
            }
            
            ctx.fillStyle = b.color;
            ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI*2); ctx.fill();
            // ç•«å‡ºçƒçš„ç§»å‹•è»Œè·¡æ„Ÿ
            ctx.shadowBlur = 15; ctx.shadowColor = b.color;
        }
    });

    ctx.restore();
    requestAnimationFrame(loop);
}
</script>
</body>
</html>
