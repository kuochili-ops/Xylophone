<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AI æœ¨ç´æ©Ÿ 2.0 - å¤šè»Œéšæ¢¯æ¼”å¥</title>
    <style>
        body { margin: 0; background: #010409; color: #fff; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        .panel { background: rgba(15, 23, 42, 0.95); padding: 12px; display: flex; gap: 10px; justify-content: center; z-index: 100; border-bottom: 2px solid #3b82f6; }
        canvas { flex-grow: 1; width: 100%; height: 100%; }
        button { border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; background: #3b82f6; }
        #status { position: fixed; bottom: 20px; left: 20px; font-size: 12px; color: #64748b; }
    </style>
</head>
<body>

<div class="panel">
    <button onclick="setupMultiLanes()">ğŸ”„ é‡ç½®ä¸¦ç”Ÿæˆé›™è»Œéšæ¢¯</button>
    <button onclick="isPaused = !isPaused" style="background:#10b981">â¯ï¸ æš«åœ/æ’­æ”¾</button>
</div>

<div id="status">å¤šè»Œç‰©ç†æ¨¡å¼å·²å•Ÿå‹• | é »ç‡è‡ªå‹•åˆ†æµ</div>
<canvas id="mainCanvas"></canvas>

<script>
const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
let audioCtx = null;
let isPaused = false;

// æ¨¡æ“¬ä¸åŒéŸ³åŸŸçš„é »ç‡
const melodyFreqs = [523.3, 587.3, 659.3, 698.5, 784, 880, 987.8]; // é«˜éŸ³çµ„
const bassFreqs = [261.6, 293.7, 329.6, 349.2, 392.0]; // ä½éŸ³çµ„

let tracks = [];
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

function playSound(freq, type = 'triangle') {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 0.5);
}

function setupMultiLanes() {
    tracks = [];
    const trackConfigs = [
        { name: "Melody", y: 200, color: "#f87171", freqs: melodyFreqs },
        { name: "Bass", y: 500, color: "#60a5fa", freqs: bassFreqs }
    ];

    trackConfigs.forEach(cfg => {
        let steps = [];
        let curX = 400, curY = cfg.y;
        
        // ç”Ÿæˆéšæ¢¯è·¯å¾‘
        for(let i = 0; i < 20; i++) {
            steps.push({
                x: curX, y: curY, 
                w: 100, h: 18, 
                freq: cfg.freqs[i % cfg.freqs.length],
                active: 0
            });
            curX += 160; curY += 40; // å½¢æˆä¸‹å¡éšæ¢¯
        }

        tracks.push({
            steps: steps,
            ball: { x: 150, y: cfg.y - 100, vx: 3.8, vy: 0, r: 12, color: cfg.color },
            currentIdx: 0,
            color: cfg.color
        });
    });
}

function update() {
    if (isPaused) return;

    tracks.forEach(track => {
        let b = track.ball;
        b.vy += 0.35; b.x += b.vx; b.y += b.vy;

        // ç¢°æ’åµæ¸¬
        let s = track.steps[track.currentIdx];
        if (s && b.x + b.r > s.x && b.x - b.r < s.x + s.w && b.y + b.r > s.y && b.vy > 0) {
            b.y = s.y - b.r;
            b.vy = -7.5; // å½ˆè·³åŠ›åº¦
            s.active = 15;
            playSound(s.freq, track.color === "#f87171" ? 'triangle' : 'sine');
            track.currentIdx++;
        }
    });
}

function draw() {
    ctx.fillStyle = "#020617";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const cameraX = tracks.length > 0 ? tracks[0].ball.x - 300 : 0;

    ctx.save();
    ctx.translate(-cameraX, 0);

    tracks.forEach(track => {
        // ç•«éŸ³æ¿
        track.steps.forEach(s => {
            ctx.fillStyle = s.active > 0 ? "#fff" : track.color;
            if(s.active > 0) s.active--;
            ctx.beginPath();
            ctx.roundRect(s.x, s.y, s.w, s.h, 5);
            ctx.fill();
        });

        // ç•«çƒ
        let b = track.ball;
        ctx.shadowBlur = 20; ctx.shadowColor = b.color;
        ctx.fillStyle = b.color;
        ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2); ctx.fill();
        ctx.shadowBlur = 0;
    });

    ctx.restore();
    update();
    requestAnimationFrame(draw);
}

setupMultiLanes();
draw();
</script>
</body>
</html>
